"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=(()=>{function a(b,c){for(var i=0,d;i<c.length;i++){d=c[i];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(b,d.key,d)}}return(b,c,d)=>{if(c)a(b.prototype,c);if(d)a(b,d);return b}})(),_createIndexValidator=require("./create-index-validator"),_createIndexValidator2=_interopRequireDefault(_createIndexValidator),_searchIndexValidator=require("./search-index-validator"),_searchIndexValidator2=_interopRequireDefault(_searchIndexValidator);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _defineProperty(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}else{a[b]=c}return a}function _toConsumableArray(a){if(Array.isArray(a)){for(var i=0,b=Array(a.length);i<a.length;i++){b[i]=a[i]}return b}else{return Array.from(a)}}function _classCallCheck(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var InvertedIndex=function(){function a(){_classCallCheck(this,a);this.index={};this.file={};this.searchResult={}}_createClass(a,[{key:"getFileContent",value:function b(){return this.file}},{key:"isFileValid",value:function b(c,d){this.validity=!0;var e=_createIndexValidator2.default.checkFileName(c);if(e){this.validity=e;return this.validity}e=_createIndexValidator2.default.checkFileContent(d);if(e){this.validity=e;return this.validity}return this.validity}},{key:"readFile",value:function b(c,d){var e=this.isFileValid(c,d);if(e===!0){this.file={fileName:c,fileContent:d,error:""}}else{this.file={error:e,fileContent:[],fileName:c}}return this.file}},{key:"createIndex",value:function b(c,d){var e=Object.prototype.hasOwnProperty,f=this.readFile(c,d).error,g={};if(f){return f}var h=d,j=0;h.forEach(k=>{var l=k.title.toLowerCase().replace(/\s\s+/g," "),m=k.text.toLowerCase().replace(/\s\s+/g," ");l=l.split(" ");m=m.split(" ");var n=[].concat(_toConsumableArray(l),_toConsumableArray(m));n.forEach(o=>{if(!e.call(g,o)){g[o]=[j]}else if(g[o].indexOf(j)<0){g[o].push(j)}});j+=1});this.index[c]=g;return this.index}},{key:"searchIndex",value:function b(c){for(var d=this,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all.json",f=arguments.length,g=Array(f>2?f-2:0),h=2;h<f;h++){g[h-2]=arguments[h]}var j=a.flattenSearchTerms(g),k=this.validateSearch(c,e,j);if(k){return k}if(e!=="all.json"){var l=this.doSearch(c,e,j);return _defineProperty({},e,l)}if(e==="all.json"){var m=Object.keys(c);m.forEach(n=>{d.searchResult[n]=d.doSearch(c,n,j)});return this.searchResult}}},{key:"doSearch",value:function b(c,d,e){var f=e,g={},h=this.validateSearch(c,d,e);if(h){return h}var j=c[d];f.forEach(k=>{var l=j[k];if(l){g[k]=l}else{g[k]=[]}});return g}},{key:"validateSearch",value:function b(c,d,e){this.errorMessage="";this.errorMessage=_searchIndexValidator2.default.checkIndex(c);if(this.errorMessage){return this.errorMessage}this.errorMessage=_searchIndexValidator2.default.checkFileName(d);if(this.errorMessage){return this.errorMessage}this.errorMessage=_searchIndexValidator2.default.checkSearchTerms(e);if(this.errorMessage){return this.errorMessage}return this.errorMessage}}],[{key:"flattenSearchTerms",value:function b(){for(var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],d=c,e="",i=0;i<d.length;i+=1){e=d[i];if(Array.isArray(e)){d.splice.apply(d,[i,1].concat(_toConsumableArray(e)));i=-1}else{var f=e.toLowerCase().replace(/\s\s+/g," "),g=f.replace(/[^0-9a-z\s]/gi,"").split(" ");if(g.length>1){d.splice.apply(d,[i,1].concat(_toConsumableArray(g)));i=-1}}}return d}}]);return a}();exports.default=InvertedIndex;